<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List App (Hint)</title>
    <link rel="stylesheet" href="HW05_01.css">
</head>
<body>

    <div class="container">
        <h1>My To-Do List</h1>
        <form id="task-form">
            <input type="text" id="task-input" placeholder="เพิ่มรายการใหม่..." autocomplete="off" required>
            <button type="submit">เพิ่ม</button>
        </form>
        <ul id="task-list">
            <!-- Tasks will be rendered here by script -->
        </ul>
    </div>

    <script type="module">
        // TODO: ส่วนที่ 1: กำหนด Interface และ State
        /**
         * @typedef {object} Task - โครงสร้างของข้อมูลสำหรับ Task แต่ละชิ้น
         * @property {number} id - ID ที่ไม่ซ้ำกันสำหรับแต่ละ task (อาจใช้ Date.now())
         * @property {string} text - ข้อความของ task
         * @property {boolean} isCompleted - สถานะว่า task เสร็จสิ้นแล้วหรือยัง
         */

        /** @type {Task[]} */
        let tasks = []; // สร้าง array ว่างสำหรับเก็บ tasks ทั้งหมด


        // TODO: ส่วนที่ 2: อ้างอิง HTML Elements (ศึกษาจากโค้ดที่มีให้)
        const taskForm = document.getElementById('task-form');
        const taskInput = document.getElementById('task-input');
        const taskList = document.getElementById('task-list');


        // TODO: ส่วนที่ 3: สร้างฟังก์ชันสำหรับจัดการข้อมูล (Logic)

        /**
         * เพิ่ม task ใหม่เข้าไปใน array `tasks`
         * @param {string} text - ข้อความของ task ที่จะเพิ่ม
         */
        function addTask(text) {
            // 1. สร้าง object `newTask` ตามโครงสร้าง Task ที่กำหนดไว้ข้างบน
            // 2. กำหนด id (เช่น Date.now()), text (ที่รับมา), และ isCompleted (ควรเป็น false ในตอนแรก)
            // 3. เพิ่ม `newTask` เข้าไปใน array `tasks` (ใช้ .push())
            console.log("Adding task:", text);
        }

        /**
         * สลับสถานะ isCompleted ของ task ที่มี id ที่กำหนด
         * @param {number} id - ID ของ task ที่จะสลับสถานะ
         */
        function toggleTaskCompleted(id) {
            // 1. ค้นหา task ใน array `tasks` ที่มี id ตรงกับที่รับมา (ใช้ .find())
            // 2. ถ้าเจอ task, ให้สลับค่า isCompleted ของ task นั้น (เช่น task.isCompleted = !task.isCompleted)
            console.log("Toggling task:", id);
        }

        /**
         * ลบ task ที่มี id ที่กำหนดออกจาก array `tasks`
         * @param {number} id - ID ของ task ที่จะลบ
         */
        function deleteTask(id) {
            // 1. สร้าง array ใหม่โดยกรองเอาเฉพาะ task ที่มี id ไม่ตรงกับที่รับมา (ใช้ .filter())
            // 2. อัปเดต array `tasks` เดิมให้เป็น array ใหม่ที่ได้จากการ filter
            console.log("Deleting task:", id);
        }


        // TODO: ส่วนที่ 4: สร้างฟังก์ชันสำหรับแสดงผล (Render)
        function renderTasks() {
            console.log("Rendering tasks...");
            // 1. ล้างข้อมูลเก่าใน taskList ทั้งหมด เพื่อเตรียมแสดงผลใหม่ (ใช้ `taskList.innerHTML = ''`)
            
            // 2. วนลูป array `tasks` (ใช้ .forEach())
            tasks.forEach(task => {
                // 3. ในแต่ละรอบของลูป, สร้าง element <li> (ใช้ document.createElement('li'))
                const li = document.createElement('li');

                // 4. กำหนด `dataset.id` ให้กับ <li> เพื่อเก็บ id ของ task (li.dataset.id = task.id)
                
                // 5. สร้าง checkbox, span, และ button สำหรับลบ
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                
                const span = document.createElement('span');
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'X';

                // 6. กำหนดค่าต่างๆ ให้กับ element ที่สร้าง (เช่น .checked, .textContent)
                checkbox.checked = task.isCompleted;
                span.textContent = task.text;

                // 7. ถ้า task.isCompleted เป็น true, ให้เพิ่ม class 'completed' ให้กับ <li> (ใช้ li.classList.add('completed'))
                if (task.isCompleted) {
                    li.classList.add('completed');
                }

                // 8. นำ checkbox, span, button ไปใส่ใน <li> (ใช้ .appendChild())
                li.appendChild(checkbox);
                li.appendChild(span);
                li.appendChild(deleteBtn);

                // 9. นำ <li> ไปใส่ใน taskList
                taskList.appendChild(li);
            });
        }


        // TODO: ส่วนที่ 5: เพิ่ม Event Listeners

        // Event Listener สำหรับการ submit form
        taskForm.addEventListener('submit', (event) => {
            // 1. ป้องกันการโหลดหน้าใหม่ (event.preventDefault())
            
            // 2. ดึงค่าจาก taskInput แล้วตัดช่องว่าง (taskInput.value.trim())
            const text = taskInput.value.trim();

            // 3. ตรวจสอบว่ามีข้อความหรือไม่
            if (text) {
                // 4. ถ้ามี, เรียกใช้ addTask(), ล้างค่าใน input, และเรียก renderTasks()
                addTask(text);
                taskInput.value = '';
                renderTasks();
            }
        });

        // Event Listener สำหรับการคลิกใน task list (ทั้ง checkbox และปุ่มลบ)
        taskList.addEventListener('click', (event) => {
            // 1. หา element <li> ที่ใกล้ที่สุดที่ถูกคลิก (event.target.closest('li'))
            const li = event.target.closest('li');

            // 2. ถ้าไม่เจอ <li> ให้หยุดทำงาน (if (!li) return;)
            if (!li) return;

            // 3. ดึง id ของ task จาก `dataset.id` ของ <li> (อย่าลืมแปลงเป็นตัวเลข Number(li.dataset.id))
            const taskId = Number(li.dataset.id);
            
            // 4. ตรวจสอบว่าสิ่งที่ถูกคลิกคือ checkbox หรือไม่ (event.target.type === 'checkbox')
            if (event.target.type === 'checkbox') {
                // 5. ถ้าใช่, เรียกใช้ toggleTaskCompleted(taskId)
                toggleTaskCompleted(taskId);
            }
            
            // 6. ตรวจสอบว่าสิ่งที่ถูกคลิกคือปุ่มลบหรือไม่ (event.target.classList.contains('delete-btn'))
            if (event.target.classList.contains('delete-btn')) {
                // 7. ถ้าใช่, เรียกใช้ deleteTask(taskId)
                deleteTask(taskId);
            }
            
            // 8. เรียก renderTasks() เพื่ออัปเดตหน้าจอทุกครั้งที่มีการเปลี่ยนแปลง
            renderTasks();
        });

    </script>

</body>
</html>